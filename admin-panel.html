<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<style>
body{
  margin:0;
  background:#12002b;
  color:#fff;
  font-family:Arial;
}
.header{
  padding:16px;
  font-size:22px;
  background:#1b003a;
}
.menu{
  display:flex;
  gap:10px;
  padding:10px;
}
.menu button{
  background:#2a0d4f;
  color:#fff;
  border:none;
  padding:8px 12px;
  border-radius:8px;
}
.box{
  background:#2a0d4f;
  margin:10px;
  padding:12px;
  border-radius:12px;
}
input{
  padding:8px;
  border:none;
  border-radius:6px;
  margin:4px 0;
}
button.action{
  background:#00e6a7;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  margin:2px;
}
button.red{background:#ff6666}
.item{
  background:#3a1b6b;
  margin-top:6px;
  padding:6px;
  border-radius:6px;
}
</style>
</head>

<body>

<div class="header">ðŸ”¥ Welcome Admin Panel</div>

<div class="menu">
  <button onclick="show('users')">Users</button>
  <button onclick="show('sell')">Sell Approvals</button>
  <button onclick="show('withdraw')">Withdraw</button>
</div>

<!-- USER CONTROL -->
<div id="users" class="box">
  <h3>User Control</h3>
  <input id="uid" placeholder="User UID">
  <input id="amount" placeholder="Amount">
  <br>
  <button class="action" onclick="addBal()">âž• Add</button>
  <button class="action" onclick="minusBal()">âž– Minus</button>
  <button class="action red" onclick="block()">ðŸš« Block</button>
  <button class="action" onclick="unblock()">âœ… Unblock</button>
</div>

<!-- SELL -->
<div id="sell" class="box" style="display:none">
  <h3>Sell Approvals</h3>
  <div id="sellList"></div>
</div>

<!-- WITHDRAW -->
<div id="withdraw" class="box" style="display:none">
  <h3>Withdraw Requests</h3>
  <div id="withdrawList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import {
  getFirestore, doc, updateDoc, increment,
  collection, getDocs
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDIETvBYGyPXKDYi_H7J4Fcxv2Ir_AN6M8",
  authDomain: "olyotaskbot-7019e.firebaseapp.com",
  projectId: "olyotaskbot-7019e"
};

const ADMIN_UID = "yTxTrE152iaCzUfmNmjxHanXN372";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* SECURITY */
onAuthStateChanged(auth,(user)=>{
  if(!user || user.uid !== ADMIN_UID){
    location.href="admin-login.html";
  }
});

/* MENU */
window.show = (id)=>{
  ["users","sell","withdraw"].forEach(x=>{
    document.getElementById(x).style.display="none";
  });
  document.getElementById(id).style.display="block";
};

/* USER */
window.addBal = async()=>{
  await updateDoc(doc(db,"users",uid.value),{balance:increment(+amount.value)});
  alert("Balance added");
};
window.minusBal = async()=>{
  await updateDoc(doc(db,"users",uid.value),{balance:increment(-amount.value)});
  alert("Balance minus");
};
window.block = async()=>{
  await updateDoc(doc(db,"users",uid.value),{blocked:true});
  alert("Blocked");
};
window.unblock = async()=>{
  await updateDoc(doc(db,"users",uid.value),{blocked:false});
  alert("Unblocked");
};

/* SELL LOAD */
const sells=["gmail_sell","facebook_sell","tiktok_sell","instagram_sell","whatsapp_sell"];

async function loadSell(){
  const box=document.getElementById("sellList");
  box.innerHTML="";
  for(const col of sells){
    const snap=await getDocs(collection(db,col));
    snap.forEach(d=>{
      if(d.data().status==="pending"){
        box.innerHTML+=`
        <div class="item">
          <b>${col}</b><br>${d.data().login}<br>
          <button class="action" onclick="approve('${col}','${d.id}','${d.data().uid}')">Approve</button>
          <button class="action red" onclick="reject('${col}','${d.id}')">Reject</button>
        </div>`;
      }
    });
  }
}

window.approve = async(col,id,uid)=>{
  await updateDoc(doc(db,col,id),{status:"approved"});
  await updateDoc(doc(db,"users",uid),{balance:increment(10)});
  loadSell();
};

window.reject = async(col,id)=>{
  await updateDoc(doc(db,col,id),{status:"rejected"});
  loadSell();
};

/* WITHDRAW */
async function loadWithdraw(){
  const box=document.getElementById("withdrawList");
  box.innerHTML="";
  const snap=await getDocs(collection(db,"withdraw_request"));
  snap.forEach(d=>{
    if(d.data().status==="pending"){
      box.innerHTML+=`
      <div class="item">
        UID:${d.data().uid}<br>
        Amount:${d.data().amount}<br>
        <button class="action" onclick="wdOk('${d.id}')">Approve</button>
        <button class="action red" onclick="wdNo('${d.id}')">Reject</button>
      </div>`;
    }
  });
}

window.wdOk = async(id)=>{
  await updateDoc(doc(db,"withdraw_request",id),{status:"approved"});
  loadWithdraw();
};
window.wdNo = async(id)=>{
  await updateDoc(doc(db,"withdraw_request",id),{status:"rejected"});
  loadWithdraw();
};

loadSell();
loadWithdraw();
</script>

</body>
</html>
